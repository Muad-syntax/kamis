<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Block Blast HTML</title>
<style>
    body {
        margin: 0; 
        display: flex; 
        justify-content: center; 
        align-items: center;
        height: 100vh;
        background: #1a1a1a;
        font-family: Arial;
        color: white;
    }

    #container {
        display: flex;
        gap: 30px;
    }

    #board {
        width: 500px;
        height: 500px;
        background: #333;
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        grid-template-rows: repeat(10, 1fr);
        gap: 3px;
        padding: 3px;
        border-radius: 10px;
    }

    .cell {
        background: #222;
        border-radius: 4px;
    }

    #pieces {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .piece {
        display: inline-grid;
        gap: 3px;
        cursor: grab;
    }

    .block {
        width: 30px;
        height: 30px;
        background: #4dabff;
        border-radius: 5px;
    }

    #score {
        position: absolute;
        top: 20px;
        font-size: 24px;
    }
</style>
</head>
<body>

<div id="score">Score: 0</div>

<div id="container">
    <div id="board"></div>
    <div id="pieces"></div>
</div>

<script>
const board = document.getElementById("board");
const piecesContainer = document.getElementById("pieces");
let score = 0;

// =========================
// MEMBUAT GRID 10x10
// =========================
let grid = [];
for (let i = 0; i < 100; i++) {
    let cell = document.createElement("div");
    cell.className = "cell";
    board.appendChild(cell);
    grid.push(null);
}

// =========================
// BENTUK BLOK
// =========================
const shapes = [
    [[1,1,1]],                   // garis mendatar
    [[1],[1],[1]],               // garis vertikal
    [[1,1],[1,1]],               // kotak 2x2
    [[1,1,1],[0,1,0]],           // T
    [[1],[1,1]],                 // L
    [[1,1],[0,1]],               // L terbalik
    [[1,1,1,1]],                 // garis panjang
    [[1,1],[1,0]]                // bentuk miring
];

// =========================
// GENERATE 3 BLOK BARU
// =========================
function generatePieces() {
    piecesContainer.innerHTML = "";

    for (let p = 0; p < 3; p++) {
        let shape = shapes[Math.floor(Math.random() * shapes.length)];

        let piece = document.createElement("div");
        piece.className = "piece";
        piece.style.gridTemplateColumns = `repeat(${shape[0].length}, 1fr)`;

        shape.forEach(row => {
            row.forEach(block => {
                if (block) {
                    let div = document.createElement("div");
                    div.className = "block";
                    piece.appendChild(div);
                } else {
                    let empty = document.createElement("div");
                    empty.style.width = "30px";
                    empty.style.height = "30px";
                    piece.appendChild(empty);
                }
            });
        });

        piece.shape = shape;

        piece.addEventListener("mousedown", () => dragPiece(piece));

        piecesContainer.appendChild(piece);
    }
}

// =========================
// DRAG & DROP LOGIC
// =========================
function dragPiece(piece) {
    let ghost = piece.cloneNode(true);
    ghost.style.position = "absolute";
    ghost.style.opacity = "0.6";
    ghost.style.pointerEvents = "none";
    document.body.appendChild(ghost);

    function move(e) {
        ghost.style.left = e.pageX - 40 + "px";
        ghost.style.top = e.pageY - 40 + "px";
    }

    function release(e) {
        document.removeEventListener("mousemove", move);
        document.removeEventListener("mouseup", release);
        ghost.remove();

        // Cek apakah bisa ditempatkan
        placePiece(piece, e.pageX, e.pageY);
    }

    document.addEventListener("mousemove", move);
    document.addEventListener("mouseup", release);
}

// =========================
// TEMPATKAN BLOK KE GRID
// =========================
function placePiece(piece, mouseX, mouseY) {
    const rect = board.getBoundingClientRect();

    let x = mouseX - rect.left;
    let y = mouseY - rect.top;

    let cellSize = rect.width / 10;
    let row = Math.floor(y / cellSize);
    let col = Math.floor(x / cellSize);

    let shape = piece.shape;

    // Cek apakah semua blok muat
    for (let r = 0; r < shape.length; r++) {
        for (let c = 0; c < shape[0].length; c++) {
            if (shape[r][c]) {
                let targetRow = row + r;
                let targetCol = col + c;
                let idx = targetRow * 10 + targetCol;

                if (
                    targetRow < 0 || targetRow >= 10 ||
                    targetCol < 0 || targetCol >= 10 ||
                    grid[idx] !== null
                ) {
                    return; // gagal pasang
                }
            }
        }
    }

    // Jika valid â†’ pasang blok
    for (let r = 0; r < shape.length; r++) {
        for (let c = 0; c < shape[0].length; c++) {
            if (shape[r][c]) {
                let targetRow = row + r;
                let targetCol = col + c;
                let idx = targetRow * 10 + targetCol;

                grid[idx] = "filled";
                board.children[idx].style.background = "#4dabff";
            }
        }
    }

    piece.remove();
    checkLines();
}

// =========================
// CEK BARIS & KOLOM PENUH
// =========================
function checkLines() {
    let cleared = 0;

    // Cek baris
    for (let r = 0; r < 10; r++) {
        let full = true;
        for (let c = 0; c < 10; c++) {
            if (grid[r * 10 + c] === null) {
                full = false;
                break;
            }
        }

        if (full) {
            cleared++;
            for (let c = 0; c < 10; c++) {
                grid[r * 10 + c] = null;
                board.children[r * 10 + c].style.background = "#222";
            }
        }
    }

    // Cek kolom
    for (let c = 0; c < 10; c++) {
        let full = true;
        for (let r = 0; r < 10; r++) {
            if (grid[r * 10 + c] === null) {
                full = false;
                break;
            }
        }

        if (full) {
            cleared++;
            for (let r = 0; r < 10; r++) {
                grid[r * 10 + c] = null;
                board.children[r * 10 + c].style.background = "#222";
            }
        }
    }

    score += cleared * 100;
    document.getElementById("score").textContent = "Score: " + score;

    // Jika semua 3 blok sudah dipakai, generate lagi
    if (piecesContainer.children.length === 0) generatePieces();
}

generatePieces();
</script>

</body>
</html>
